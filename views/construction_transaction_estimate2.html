<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, user-scalable=no">
	<link rel="shortcut icon" type="image/ico" href="http://www.datatables.net/favicon.ico">
	<title>Conaz_admin</title>
	</style>
	  <script
	  src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script> 
		
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/datetime/1.1.2/css/dataTables.dateTime.min.css">
	<link rel="stylesheet" type="text/css" href="css/editor.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="../views/resources/syntax/shCore.css">
	<link rel="stylesheet" type="text/css" href="../views/resources/demo.css">
	<link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
	<!-- 추가-->
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/searchpanes/1.2.1/css/searchPanes.dataTables.min.css">
		<!-- 추가-->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous"/>

	<script>
	   // You have a 'moment' global here
	   const today = moment();
	 </script>
	   <style>
		thead input {
		  width: 100%;
			text-align: center;
		}
	  </style>
	
	<script
	type="text/javascript"
	language="javascript"
	src="https://code.jquery.com/jquery-3.5.1.js"
  ></script>
  <script
	type="text/javascript"
	language="javascript"
	src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"
  ></script>
  <script
	type="text/javascript"
	language="javascript"
	src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"
  ></script>
  <script
	type="text/javascript"
	language="javascript"
	src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"
  ></script>
	<!-- 추가 -->
	<script
	type="text/javascript"
	language="javascript"
	src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"
  ></script>

	<!-- <script src="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css"></script> -->
		<!-- 추가 -->
	<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/searchpanes/1.2.1/js/dataTables.searchPanes.min.js"></script>
	<script type="text/javascript" language="javascript" src="../js/dataTables.editor.min.js"></script>
	<script type="text/javascript" language="javascript" src="./resources/syntax/shCore.js"></script>
	<script type="text/javascript" language="javascript" src="./resources/demo.js"></script>
	<script type="text/javascript" language="javascript" src="./resources/editor-demo.js"></script>
	<script type="text/javascript" language="javascript" class="init">
	//Korean    
	var lang_kor={
		"decimal":"","emptyTable":"데이터가 없습니다.","info":"_START_ 부터- _END_ 까지 (총 _TOTAL_ 데이터)","infoEmpty":"0개","infoFiltered":"(전체 _MAX_명 중 검색결과)",
		"infoPostFix":"","thousands":",",
		"lengthMenu":"_MENU_개씩 보기",
		"loadingRecords":"로딩중...","processing":"처리중...","search":"검색 :","zeroRecords":"검색된 데이터가 없습니다."
		,"paginate":{"first":"첫 페이지","last":"마지막페이지","next":"다음","previous":"이전"},"aria":{"sortAscending":":오름차순 정렬","sortDescending":":내림차순 정렬"}};
		
		
		// window.location.reload();
		var editor; // use a global for the submit and return data rendering in the examples
		var keyid = sessionStorage.getItem("id");
		console.log("키값확인", keyid);
		$(document).ready(function () {
			//CRUD
			editor = new $.fn.dataTable.Editor({
				ajax: `/api/construction_esimate_management/${keyid}`,
				table: "#esimate_management",
				fields: [
					{
						label: "레미콘 공장",
						name: "spaces.name",
					},
					{
						label: "레미콘 공장 주소",
						name: "spaces.basic_address",
					},					
					{
						label: "영업사원",
						name: "users.name",
					},
					{
						label: "단가율",
						name: "estimations.percent",	
					},
					{
						label: "견적요청 일시",
						name: "estimations.created_at",
					},
					{
						label: "상태",
						name: "estimations.status",
					},
				],
				
			});

	
			// 항목별 검색기능
			$("#esimate_management thead tr")
				.clone(true)
				.addClass("filters")
				.appendTo("#esimate_management thead");

			$("#esimate_management").DataTable(
				{
					orderCellsTop: true,
					fixedHeader: true,
					initComplete: function () {
						var api = this.api();

						// For each column
						api
							.columns()
							.eq(0)
							.each(function (colIdx) {
								// Set the header cell to contain the input element
								var cell = $(".filters th").eq(
									$(api.column(colIdx).header()).index()
								);
								var title = $(cell).text();
								$(cell).html(
									'<input type="text" placeholder="' + title + '" />'
								);

								// On every keypress in this input
								$(
									"input",
									$(".filters th").eq($(api.column(colIdx).header()).index())
								)
									.off("keyup change")
									.on("change", function (e) {
										// Get the search value
										$(this).attr("title", $(this).val());
										var regexr = "({search})"; //$(this).parents('th').find('select').val();

										var cursorPosition = this.selectionStart;
										// Search the column for that value
										api
											.column(colIdx)
											.search(
												this.value != ""
													? regexr.replace(
															"{search}",
															"(((" + this.value + ")))"
														)
													: "",
												this.value != "",
												this.value == ""
											)
											.draw();
									})
									.on("keyup", function (e) {
										e.stopPropagation();

										$(this).trigger("change");
										$(this)
											.focus()[0]
											.setSelectionRange(cursorPosition, cursorPosition);
									});
							});
					},
					// 항목별 검색기능 끝. keyid		url:`/api/esimate_management/:${id}`,
				//DATA 바인딩
					dom: "Bfrtip",
					ajax: { 
						url:`/api/construction_esimate_management/${keyid}`,
						type:"get"
					},
					language : lang_kor,
					columns: [
						{ data: "spaces.name" },
						{ data: "spaces.basic_address"},
						{ data: "users.name"},
						{ data: "estimations.percent" },
						{ data: "estimations.created_at" },			
						{ data: "estimations.status" },	
					],
				//	serverSide: true,
					destory:true,
					select: true,
					buttons: [
						{ extend: "create", editor: editor, text: "등록" },
						{ extend: "edit", editor: editor, text: "수정" },
						{ extend: "remove", editor: editor, text: "삭제" },
					],
				},
				
			);
		});
</script>
</head>
<body class="dt-example node">
			<h1 style="margin: 10px;" >건설사 견적내역</h1>
	
					<div class="demo-html">
						<table id="esimate_management" class="display" style="width:100%" cellspacing="0">
							<thead>
								<tr>
									<th>레미콘공장</th>
									<th>레미콘 공장 주소</th>
									<!-- <th>시간/거리</th>
									<th>생산설비</th> -->
									<th>영업사원</th>
									<th>단가율</th>
									<th>견적요청 일시</th>
									<th>상태</th>
								</tr>
							</thead>						
						</table>				
		  </div>
</body>
</html>
